#!/bin/bash -e

set -u

version=pg

source $OPENSHIFT_CARTRIDGE_SDK_BASH

for dir in logs pid tmp env; do
	mkdir -p $dir
done

mkdir -p $OPENSHIFT_DATA_DIR/.$version/data

echo $(pwd)/versions/$version/bin > env/OPENSHIFT_PG_PATH_ELEMENT
echo $(pwd)/versions/$version/lib > env/LD_LIBRARY_PATH
echo $OPENSHIFT_PG_HOST > env/STATHOST

if [ -n "$JEFF_NODE_TYPE" ]; then
		client_result "$JEFF_NODE_TYPE is being setup"

		if [ "$JEFF_NODE_TYPE" == "master" ]; then
			add_domain_env_var "JEFF_MASTER_USER=${USER}"
			add_domain_env_var "JEFF_MASTER_DNS=${OPENSHIFT_APP_DNS}"
			add_domain_env_var "JEFF_MASTER_IP=${OPENSHIFT_PG_HOST}"
		elif  [ "$JEFF_NODE_TYPE" == "standby" ]; then
			add_domain_env_var "JEFF_STANDBY_USER=${USER}"
			add_domain_env_var "JEFF_STANDBY_DNS=${OPENSHIFT_APP_DNS}"
			add_domain_env_var "JEFF_STANDBY_IP=${OPENSHIFT_PG_HOST}"
		fi
fi

client_result "$version setup completed"
